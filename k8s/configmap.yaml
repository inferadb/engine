apiVersion: v1
kind: ConfigMap
metadata:
  name: inferadb-engine-config
  labels:
    app: inferadb-engine
    component: engine
data:
  # Root-level configuration
  INFERADB__ENGINE__THREADS: "4"
  INFERADB__ENGINE__LOGGING: "info"

  # Listen configuration (combined host:port addresses)
  INFERADB__ENGINE__LISTEN__HTTP: "0.0.0.0:8080"
  INFERADB__ENGINE__LISTEN__GRPC: "0.0.0.0:8081"
  INFERADB__ENGINE__LISTEN__MESH: "0.0.0.0:8082"

  # Storage configuration
  INFERADB__ENGINE__STORAGE: "ledger"
  INFERADB__ENGINE__LEDGER__ENDPOINT: "http://inferadb-ledger-client.inferadb:50051"
  INFERADB__ENGINE__LEDGER__CLIENT_ID: "engine-001"
  INFERADB__ENGINE__LEDGER__NAMESPACE_ID: "1"

  # Cache configuration
  INFERADB__ENGINE__CACHE__ENABLED: "true"
  INFERADB__ENGINE__CACHE__CAPACITY: "100000"
  INFERADB__ENGINE__CACHE__TTL: "600"

  # Token validation configuration
  INFERADB__ENGINE__TOKEN__CACHE_TTL: "300"
  INFERADB__ENGINE__TOKEN__CLOCK_SKEW: "60"
  INFERADB__ENGINE__TOKEN__MAX_AGE: "86400"

  # Mesh configuration (communication with Control service)
  INFERADB__ENGINE__MESH__URL: "http://inferadb-control.inferadb:9092"
  INFERADB__ENGINE__MESH__TIMEOUT: "5000"
  INFERADB__ENGINE__MESH__CACHE_TTL: "300"
  INFERADB__ENGINE__MESH__CERT_CACHE_TTL: "900"

  # Discovery configuration
  INFERADB__ENGINE__DISCOVERY__MODE: '{"type": "kubernetes"}'
  INFERADB__ENGINE__DISCOVERY__CACHE_TTL: "300"
  INFERADB__ENGINE__DISCOVERY__HEALTH_CHECK_INTERVAL: "30"

  # Configuration file (optional alternative to env vars)
  config.yaml: |
    engine:
      threads: 4
      logging: "info"

      listen:
        http: "0.0.0.0:8080"
        grpc: "0.0.0.0:8081"
        mesh: "0.0.0.0:8082"

      storage: "ledger"
      ledger:
        endpoint: "http://inferadb-ledger-client.inferadb:50051"
        client_id: "engine-001"
        namespace_id: 1

      cache:
        enabled: true
        capacity: 100000
        ttl: 600

      token:
        cache_ttl: 300
        clock_skew: 60
        max_age: 86400

      mesh:
        url: "http://inferadb-control.inferadb:9092"
        timeout: 5000
        cache_ttl: 300
        cert_cache_ttl: 900

      discovery:
        mode:
          type: kubernetes
        cache_ttl: 300
        health_check_interval: 30
