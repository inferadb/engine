apiVersion: v1
kind: ConfigMap
metadata:
  name: inferadb-engine-config
  labels:
    app: inferadb-engine
    component: server
data:
  # Environment variables
  INFERADB__SERVER__WORKER_THREADS: "4"

  INFERADB__STORAGE__BACKEND: "foundationdb"
  INFERADB__STORAGE__FDB_CLUSTER_FILE: "/etc/foundationdb/fdb.cluster"

  INFERADB__CACHE__ENABLED: "true"
  INFERADB__CACHE__MAX_CAPACITY: "100000"
  INFERADB__CACHE__TTL_SECONDS: "600"

  INFERADB__OBSERVABILITY__LOG_LEVEL: "info"
  INFERADB__OBSERVABILITY__METRICS_ENABLED: "true"
  INFERADB__OBSERVABILITY__TRACING_ENABLED: "true"

  INFERADB__AUTH__ENABLED: "true"
  INFERADB__AUTH__JWKS_CACHE_TTL: "300"
  INFERADB__AUTH__REPLAY_PROTECTION: "true"
  INFERADB__AUTH__REQUIRE_JTI: "true"
  INFERADB__AUTH__CLOCK_SKEW_SECONDS: "30"
  INFERADB__AUTH__MAX_TOKEN_AGE_SECONDS: "3600"

  # Configuration file
  config.yaml: |
    server:
      host: "0.0.0.0"
      port: 8080
      worker_threads: 4

    storage:
      backend: "foundationdb"
      fdb_cluster_file: "/etc/foundationdb/fdb.cluster"

    cache:
      enabled: true
      max_capacity: 100000
      ttl: 600

    observability:
      log_level: "info"
      metrics_enabled: true
      tracing_enabled: true

    auth:
      enabled: true
      jwks_cache_ttl: 300
      replay_protection: true
      require_jti: true
      clock_skew_seconds: 30
      max_token_age_seconds: 3600
      jwks_url: "${INFERADB__AUTH__JWKS_URL}"
      redis_url: "${INFERADB__AUTH__REDIS_URL}"
